<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Catalogue Selector</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: block;
        }
        
        /* Hide all pages by default */
        .page {
            display: none;
        }
        
        /* Show the active page */
        .page.active {
            display: block;
        }
        
        /* WELCOME PAGE STYLES */
        .header {
            background: linear-gradient(to right, #4b6cb7, #182848);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .content {
            padding: 50px 30px;
        }
        
        .question-section {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .question-section h2 {
            font-size: 2.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .question-section p {
            font-size: 1.1rem;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto 30px;
        }
        
        .catalogue-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
        }
        
        .option-card {
            background-color: white;
            border-radius: 15px;
            width: 250px;
            padding: 30px 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            border-color: #4b6cb7;
        }
        
        .option-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            color: white;
        }
        
        .attendance .option-icon {
            background: linear-gradient(to right, #00b09b, #96c93d);
        }
        
        .financial .option-icon {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
        }
        
        .progress .option-icon {
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }
        
        .option-card h3 {
            font-size: 1.6rem;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .option-card p {
            color: #7f8c8d;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        /* ATTENDANCE PAGE STYLES */
        .attendance-header {
            background: linear-gradient(to right, #00b09b, #96c93d);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .attendance-header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .attendance-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .activity-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
        }
        
        .activity-card {
            background-color: white;
            border-radius: 15px;
            width: 300px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .activity-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .push-to-start .activity-card:hover {
            border-color: #00b09b;
        }
        
        .register-vacation .activity-card:hover {
            border-color: #3498db;
        }
        
        .activity-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 3rem;
            color: white;
        }
        
        .push-to-start .activity-icon {
            background: linear-gradient(to right, #00b09b, #96c93d);
        }
        
        .register-vacation .activity-icon {
            background: linear-gradient(to right, #3498db, #2ecc71);
        }
        
        .activity-card h3 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .activity-card p {
            color: #7f8c8d;
            line-height: 1.5;
            font-size: 1rem;
            margin-bottom: 25px;
        }
        
        .activity-details {
            text-align: left;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .activity-details h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .activity-details ul {
            padding-left: 20px;
            color: #555;
        }
        
        .activity-details li {
            margin-bottom: 5px;
        }
        
        /* PUSH-TO-START DATA COLLECTION PAGE */
        .data-collection-header {
            background: linear-gradient(to right, #00b09b, #96c93d);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .data-collection-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .data-collection-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .data-collection-content {
            padding: 40px 30px;
        }
        
        .clock-status {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .clock-icon {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(to right, #00b09b, #96c93d);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 3.5rem;
            color: white;
            animation: pulse 2s infinite;
        }
        
        .clock-status h2 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .clock-status p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .success-message {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
            display: none;
        }
        
        .success-message.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background-color: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            color: white;
        }
        
        .success-message h3 {
            color: #155724;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .success-message p {
            color: #0c5460;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .data-collection-section {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .data-collection-section h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .data-item {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .data-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-item h4 i {
            color: #00b09b;
        }
        
        .data-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #00b09b;
            word-break: break-word;
        }
        
        .data-loading {
            color: #7f8c8d;
            font-style: italic;
        }
        
        .data-error {
            color: #e74c3c;
        }
        
        .data-success {
            color: #27ae60;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }
        
        .btn {
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, #00b09b, #96c93d);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 176, 155, 0.3);
        }
        
        .btn-secondary {
            background-color: #f8f9fa;
            color: #2c3e50;
            border: 2px solid #ddd;
        }
        
        .btn-secondary:hover {
            background-color: #e9ecef;
        }
        
        .selection-message {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f8f9fa;
            display: none;
        }
        
        .selection-message.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .selection-message h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .selection-message p {
            color: #4b6cb7;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .page.active {
            animation: slideIn 0.5s ease;
        }
        
        @media (max-width: 850px) {
            .catalogue-options, .activity-options {
                gap: 20px;
            }
            
            .option-card {
                width: 220px;
            }
            
            .activity-card, .data-item {
                width: 100%;
                max-width: 350px;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 650px) {
            .catalogue-options, .activity-options {
                flex-direction: column;
                align-items: center;
            }
            
            .option-card, .activity-card {
                width: 100%;
                max-width: 350px;
            }
            
            .header h1, .attendance-header h1, .data-collection-header h1 {
                font-size: 2.2rem;
            }
            
            .question-section h2 {
                font-size: 1.8rem;
            }
            
            .back-button {
                top: 10px;
                left: 10px;
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
  </head>
  <body> <!-- WELCOME PAGE -->
    <div class="container">
      <div id="welcomePage" class="page active">
        <div class="header">
          <h1>System Dashboard</h1>
          <p>Welcome to the management system. Please select a catalogue to
            proceed.</p>
        </div>
        <div class="content">
          <div class="question-section">
            <h2>Select Catalogue</h2>
            <p>Choose one of the following catalogues to access the relevant
              system module. Each option provides different management
              functionalities.</p>
            <div class="catalogue-options">
              <div class="option-card attendance" onclick="goToAttendancePage()">
                <div class="option-icon"> <i class="fas fa-clipboard-check"></i>
                </div>
                <h3>Attendance</h3>
                <p>Track and manage employee or student attendance records, view
                  reports, and manage schedules.</p>
              </div>
              <div class="option-card financial" onclick="selectCatalogue('Financial')">
                <div class="option-icon"> <i class="fas fa-chart-line"></i> </div>
                <h3>Financial</h3>
                <p>Access financial data, budgeting tools, expense tracking, and
                  financial reports.</p>
              </div>
              <div class="option-card progress" onclick="selectCatalogue('Progress')">
                <div class="option-icon"> <i class="fas fa-tasks"></i> </div>
                <h3>Progress</h3>
                <p>Monitor project progress, performance metrics, and track
                  goals and milestones.</p>
              </div>
            </div>
          </div>
          <div id="selectionMessage" class="selection-message">
            <h3>Selected Catalogue:</h3>
            <p id="selectedCatalogue"></p>
          </div>
        </div>
        <div class="footer">
          <p>System Catalogue Selector © 2023 | Select an option to continue</p>
        </div>
      </div>
      <!-- ATTENDANCE PAGE -->
      <div id="attendancePage" class="page">
        <div class="attendance-header"> <button class="back-button" onclick="goBackToWelcome()">
            <i class="fas fa-arrow-left"></i> </button>
          <h1>Attendance Module</h1>
          <p>Manage attendance records, clock in/out, and vacation requests</p>
        </div>
        <div class="content">
          <div class="question-section">
            <h2>Select Activity</h2>
            <p>Choose an activity to perform in the Attendance module. Each
              option provides different attendance management functionalities.</p>
            <div class="activity-options">
              <div class="activity-card push-to-start" onclick="goToPushToStartPage()">
                <div class="activity-icon"> <i class="fas fa-play-circle"></i>
                </div>
                <h3>Push-to-start</h3>
                <p>Clock in to start your workday or mark the beginning of a
                  session.</p>
                <div class="activity-details">
                  <h4>What you can do:</h4>
                  <ul>
                    <li>Clock in for work</li>
                    <li>Start a break timer</li>
                    <li>Begin a training session</li>
                    <li>Start project time tracking</li>
                  </ul>
                </div>
              </div>
              <div class="activity-card register-vacation" onclick="selectAttendanceActivity('Register Vacation')">
                <div class="activity-icon"> <i class="fas fa-umbrella-beach"></i>
                </div>
                <h3>Register Vacation</h3>
                <p>Submit vacation requests, view available days, and check
                  request status.</p>
                <div class="activity-details">
                  <h4>What you can do:</h4>
                  <ul>
                    <li>Request time off</li>
                    <li>Check vacation balance</li>
                    <li>View pending requests</li>
                    <li>Cancel vacation requests</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div id="attendanceSelectionMessage" class="selection-message">
            <h3>Selected Activity:</h3>
            <p id="selectedActivity"></p>
          </div>
        </div>
        <div class="footer">
          <p>Attendance Module © 2023 | Select an activity to continue</p>
        </div>
      </div>
      <!-- PUSH-TO-START DATA COLLECTION PAGE -->
      <div id="pushToStartPage" class="page">
        <div class="data-collection-header"> <button class="back-button" onclick="goBackToAttendance()">
            <i class="fas fa-arrow-left"></i> </button>
          <h1>Push-to-Start: Clock In</h1>
          <p>Automatically collecting your information for attendance tracking</p>
        </div>
        <div class="data-collection-content">
          <div class="clock-status">
            <div class="clock-icon"> <i class="fas fa-clock"></i> </div>
            <h2>Clock In Session Started</h2>
            <p>Your attendance session is being recorded with the following
              information:</p>
          </div>
          <!-- Success Message (shown after auto-clock-in) -->
          <div id="successMessage" class="success-message">
            <div class="success-icon"> <i class="fas fa-check"></i> </div>
            <h3>Clock In Successful!</h3>
            <p>Your attendance has been automatically recorded.</p>
            <p id="successDetails">Loading details...</p>
            <p id="googleSheetsStatus" style="font-size: 0.9rem; margin-top: 10px;"></p>
          </div>
          <div class="data-collection-section">
            <h3>Collected Information</h3>
            <div class="data-grid">
              <div class="data-item">
                <h4><i class="fas fa-envelope"></i> Browser Account Email</h4>
                <div id="userEmail" class="data-value data-loading">Detecting
                  browser account...</div>
              </div>
              <div class="data-item">
                <h4><i class="fas fa-calendar-day"></i> Current Date</h4>
                <div id="currentDate" class="data-value data-loading">Getting
                  date...</div>
              </div>
              <div class="data-item">
                <h4><i class="fas fa-clock"></i> Clock In Time</h4>
                <div id="clockInTime" class="data-value data-loading">Capturing
                  time...</div>
              </div>
              <div class="data-item">
                <h4><i class="fas fa-map-marker-alt"></i> Geolocation</h4>
                <div id="geolocation" class="data-value data-loading">Requesting
                  location access...</div>
              </div>
            </div>
          </div>
          <div class="action-buttons"> <button class="btn btn-secondary" onclick="goBackToAttendance()">
              <i class="fas fa-arrow-left"></i> Back to Activities </button> </div>
          <div id="dataCollectionMessage" class="selection-message">
            <h3>Status:</h3>
            <p id="collectionStatus">Collecting data...</p>
          </div>
        </div>
        <div class="footer">
          <p>Push-to-Start Module © 2023 | Your privacy is protected. Data is
            encrypted and secured.</p>
        </div>
      </div>
    </div>
    <script>
        // Global variables to store collected data
        let userData = {
            email: null,
            date: null,
            time: null,
            geolocation: null,
            pushTime: null,
            browserInfo: null,
            clockInCompleted: false,
            googleSheetsSaved: false
        };
        
        // Google Sheets Configuration
        const GOOGLE_SHEETS_CONFIG = {
            // Your Google Sheet ID (from the URL: https://docs.google.com/spreadsheets/d/[THIS_IS_THE_ID]/edit...)
            sheetId: '1kU1mcr237FoOMVvONYlHlpTXZzOKRQdtnesik_hvw2A',
            
            // Sheet name (tab name)
            sheetName: 'sheet1', // Change this if your sheet has a different name
            
            // Google Apps Script Web App URL
            // You need to create a Google Apps Script and deploy it as a Web App
            scriptUrl: 'https://script.google.com/macros/s/AKfycbyoG12wC41hUWoTOQRmzCid4_yojNCxC3UR_bd7G8xovETipegbnnJnzrFyqA71SS7d-Q/exec'
        };
        
        // Page navigation functions
        function goToAttendancePage() {
            document.getElementById('welcomePage').classList.remove('active');
            document.getElementById('attendancePage').classList.add('active');
            document.getElementById('attendanceSelectionMessage').classList.remove('active');
        }
        
        function goBackToWelcome() {
            document.getElementById('attendancePage').classList.remove('active');
            document.getElementById('welcomePage').classList.add('active');
        }
        
        function goBackToAttendance() {
            document.getElementById('pushToStartPage').classList.remove('active');
            document.getElementById('attendancePage').classList.add('active');
        }
        
        function goToPushToStartPage() {
            // Capture the exact time when push-to-start was clicked
            userData.pushTime = new Date();
            
            document.getElementById('attendancePage').classList.remove('active');
            document.getElementById('pushToStartPage').classList.add('active');
            
            // Reset clock-in status
            userData.clockInCompleted = false;
            userData.googleSheetsSaved = false;
            
            // Start collecting data automatically
            startDataCollection();
        }
        
        function selectCatalogue(catalogue) {
            if (catalogue === 'Attendance') {
                goToAttendancePage();
                return;
            }
            
            document.getElementById('selectedCatalogue').textContent = catalogue;
            const messageDiv = document.getElementById('selectionMessage');
            messageDiv.classList.add('active');
            
            const cards = document.querySelectorAll('.option-card');
            cards.forEach(card => {
                card.style.borderColor = 'transparent';
                card.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.08)';
            });
            
            let selectedCard;
            if (catalogue === 'Attendance') {
                selectedCard = document.querySelector('.attendance');
            } else if (catalogue === 'Financial') {
                selectedCard = document.querySelector('.financial');
            } else {
                selectedCard = document.querySelector('.progress');
            }
            
            selectedCard.style.borderColor = '#4b6cb7';
            selectedCard.style.boxShadow = '0 15px 30px rgba(75, 108, 183, 0.3)';
            
            console.log(`Redirecting to ${catalogue} catalogue...`);
            
            if (catalogue !== 'Attendance') {
                setTimeout(() => {
                    alert(`The ${catalogue} module is not implemented in this demo. Only the Attendance module is available.`);
                }, 500);
            }
        }
        
        function selectAttendanceActivity(activity) {
            document.getElementById('selectedActivity').textContent = activity;
            const messageDiv = document.getElementById('attendanceSelectionMessage');
            messageDiv.classList.add('active');
            
            const cards = document.querySelectorAll('.activity-card');
            cards.forEach(card => {
                card.style.borderColor = 'transparent';
                card.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.08)';
            });
            
            let selectedCard;
            if (activity === 'Push-to-start') {
                selectedCard = document.querySelector('.push-to-start');
                selectedCard.style.borderColor = '#00b09b';
                selectedCard.style.boxShadow = '0 15px 30px rgba(0, 176, 155, 0.3)';
                goToPushToStartPage();
            } else {
                selectedCard = document.querySelector('.register-vacation');
                selectedCard.style.borderColor = '#3498db';
                selectedCard.style.boxShadow = '0 15px 30px rgba(52, 152, 219, 0.3)';
                
                setTimeout(() => {
                    alert(`Opening vacation registration form...\n\nIn a real application, this would:\n1. Show your available vacation days\n2. Open a date picker for selection\n3. Allow you to specify vacation type\n4. Submit the request for approval`);
                }, 500);
            }
        }
        
        // Browser Account Detection
        function detectBrowserAccount() {
            // Store browser information
            userData.browserInfo = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                vendor: navigator.vendor,
                language: navigator.language,
                languages: navigator.languages,
                cookieEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack,
                hardwareConcurrency: navigator.hardwareConcurrency,
                maxTouchPoints: navigator.maxTouchPoints,
                pdfViewerEnabled: navigator.pdfViewerEnabled
            };
            
            // Try multiple methods to get browser account email
            let detectedEmail = null;
            
            // Method 1: Try to get from browser's credential management API
            if (navigator.credentials && navigator.credentials.get) {
                try {
                    // This would work if the site has saved credentials
                    const cred = navigator.credentials.get({
                        password: true,
                        mediation: 'silent'
                    });
                    
                    if (cred && cred.id && cred.id.includes('@')) {
                        detectedEmail = cred.id;
                    }
                } catch (e) {
                    // Credential API not available or blocked
                    console.log("Credential API not accessible:", e);
                }
            }
            
            // Method 2: Check for Google Chrome sync status (for Chrome browsers)
            if (!detectedEmail && /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor)) {
                // In Chrome, we can try to detect if user is signed in
                detectedEmail = detectChromeAccount();
            }
            
            // Method 3: Check for Firefox account
            if (!detectedEmail && /Firefox/.test(navigator.userAgent)) {
                detectedEmail = detectFirefoxAccount();
            }
            
            // Method 4: Check for Safari/Apple account
            if (!detectedEmail && /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)) {
                detectedEmail = detectSafariAccount();
            }
            
            // Method 5: Check for Microsoft Edge account
            if (!detectedEmail && /Edg/.test(navigator.userAgent)) {
                detectedEmail = detectEdgeAccount();
            }
            
            // Method 6: Check localStorage for previously saved email
            if (!detectedEmail) {
                detectedEmail = localStorage.getItem('browserAccountEmail');
            }
            
            // Method 7: Check for any stored authentication data
            if (!detectedEmail) {
                detectedEmail = scanStorageForEmail();
            }
            
            return detectedEmail;
        }
        
        function detectChromeAccount() {
            // Chrome stores sync information in localStorage when signed in
            // Look for Chrome-specific keys
            const chromeKeys = [
                'chrome_sync',
                'google_account',
                'gaia_auth',
                'chrome_signed_in',
                'sync_account'
            ];
            
            for (const key of chromeKeys) {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        if (parsed && parsed.email) {
                            return parsed.email;
                        }
                    } catch (e) {
                        // Not JSON, check if it looks like an email
                        if (value.includes('@') && value.includes('.')) {
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (emailRegex.test(value)) {
                                return value;
                            }
                        }
                    }
                }
            }
            
            // Check for Google OAuth tokens
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.includes('google') || key.includes('oauth') || key.includes('auth')) {
                    const value = localStorage.getItem(key);
                    if (value && value.includes('@')) {
                        try {
                            // Try to parse as JWT
                            const parts = value.split('.');
                            if (parts.length === 3) {
                                const payload = JSON.parse(atob(parts[1]));
                                if (payload && payload.email) {
                                    return payload.email;
                                }
                            }
                        } catch (e) {
                            // Not JWT, continue
                        }
                    }
                }
            }
            
            return null;
        }
        
        function detectFirefoxAccount() {
            // Firefox account detection
            // Firefox sync accounts might be stored in indexedDB or localStorage
            const firefoxKeys = [
                'firefox_account',
                'fxaccount',
                'mozilla_account',
                'sync_account'
            ];
            
            for (const key of firefoxKeys) {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        if (parsed && parsed.email) {
                            return parsed.email;
                        }
                    } catch (e) {
                        // Not JSON, check if it looks like an email
                        if (value.includes('@') && value.includes('.')) {
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (emailRegex.test(value)) {
                                return value;
                            }
                        }
                    }
                }
            }
            
            return null;
        }
        
        function detectSafariAccount() {
            // Safari/iCloud account detection
            // Safari uses iCloud Keychain for account storage
            // In a web context, we can only check for iCloud cookies or localStorage
            const safariKeys = [
                'apple_account',
                'icloud_account',
                'safari_account'
            ];
            
            for (const key of safariKeys) {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        if (parsed && parsed.email) {
                            return parsed.email;
                        }
                    } catch (e) {
                        // Not JSON, check if it looks like an email
                        if (value.includes('@') && value.includes('.')) {
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (emailRegex.test(value)) {
                                return value;
                            }
                        }
                    }
                }
            }
            
            return null;
        }
        
        function detectEdgeAccount() {
            // Microsoft Edge account detection
            // Edge uses Microsoft accounts for sync
            const edgeKeys = [
                'edge_account',
                'microsoft_account',
                'live_account',
                'outlook_account'
            ];
            
            for (const key of edgeKeys) {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        if (parsed && parsed.email) {
                            return parsed.email;
                        }
                    } catch (e) {
                        // Not JSON, check if it looks like an email
                        if (value.includes('@') && value.includes('.')) {
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (emailRegex.test(value)) {
                                return value;
                            }
                        }
                    }
                }
            }
            
            return null;
        }
        
        function scanStorageForEmail() {
            // Scan all localStorage for email patterns
            const emailPattern = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                
                if (value && typeof value === 'string' && value.length < 500) {
                    const matches = value.match(emailPattern);
                    if (matches && matches.length > 0) {
                        // Return the first valid email
                        for (const email of matches) {
                            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (emailRegex.test(email)) {
                                return email;
                            }
                        }
                    }
                }
            }
            
            return null;
        }
        
        function generateBrowserFingerprint() {
            // Generate a unique fingerprint based on browser characteristics
            const components = [
                navigator.userAgent,
                navigator.platform,
                navigator.language,
                navigator.hardwareConcurrency,
                navigator.maxTouchPoints,
                screen.width + 'x' + screen.height,
                screen.colorDepth + 'bit'
            ];
            
            // Create a simple hash
            let hash = 0;
            const str = components.join('|');
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            
            return 'browser-' + Math.abs(hash).toString(16).substring(0, 8);
        }
        
        // Save data to Google Sheets
        async function saveToGoogleSheets() {
            if (userData.googleSheetsSaved) {
                return true; // Already saved
            }
            
            updateStatus("Saving data to Google Sheets...");
            
            try {
                // Prepare the data for Google Sheets
                const sheetData = {
                    email: userData.email || 'Not detected',
                    date: userData.date || 'Not available',
                    time: userData.time || 'Not available',
                    location: userData.geolocation ? 
                        `Lat: ${userData.geolocation.lat.toFixed(6)}, Lng: ${userData.geolocation.lng.toFixed(6)}` : 
                        'Not available',
                    accuracy: userData.geolocation ? `${Math.round(userData.geolocation.accuracy)}m` : 'N/A',
                    timestamp: new Date().toISOString(),
                    browser: navigator.userAgent.substring(0, 100),
                    ip: 'Not captured (requires server-side)'
                };
                
                // Method 1: Try using Google Apps Script Web App
                const response = await fetch(GOOGLE_SHEETS_CONFIG.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors', // Note: no-cors mode doesn't allow reading response
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sheetData)
                });
                
                // Since we're using no-cors, we can't read the response
                // But we assume it worked if no error was thrown
                userData.googleSheetsSaved = true;
                
                // Update UI to show success
                document.getElementById('googleSheetsStatus').innerHTML = 
                    '<span style="color: #28a745;"><i class="fas fa-check-circle"></i> Data saved to Google Sheets</span>';
                
                updateStatus("Data successfully saved to Google Sheets!");
                return true;
                
            } catch (error) {
                console.error("Error saving to Google Sheets:", error);
                
                // Fallback: Save to localStorage and show instructions
                const failedRecords = JSON.parse(localStorage.getItem('failedGoogleSheetsRecords') || '[]');
                failedRecords.push({
                    ...sheetData,
                    error: error.message,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('failedGoogleSheetsRecords', JSON.stringify(failedRecords));
                
                document.getElementById('googleSheetsStatus').innerHTML = 
                    '<span style="color: #dc3545;"><i class="fas fa-exclamation-triangle"></i> Failed to save to Google Sheets. Data stored locally.</span>';
                
                updateStatus("Could not save to Google Sheets. Data stored locally.");
                return false;
            }
        }
        
        // Automatic clock-in function
        async function autoClockIn() {
            if (userData.clockInCompleted) {
                return; // Already clocked in
            }
            
            // Validate that we have all required data
            if (!userData.email || !userData.date || !userData.time) {
                updateStatus("Waiting for data collection to complete...");
                return;
            }
            
            // Mark as completed
            userData.clockInCompleted = true;
            
            // Save to localStorage (simulating server storage)
            const clockInRecords = JSON.parse(localStorage.getItem('clockInRecords') || '[]');
            clockInRecords.push({
                ...userData,
                timestamp: new Date().toISOString(),
                status: 'auto_clocked_in',
                pushTimestamp: userData.pushTime ? userData.pushTime.toISOString() : new Date().toISOString(),
                browserInfo: userData.browserInfo
            });
            localStorage.setItem('clockInRecords', JSON.stringify(clockInRecords));
            
            // Try to save to Google Sheets
            const sheetsSuccess = await saveToGoogleSheets();
            
            // Show success message
            const successMessage = document.getElementById('successMessage');
            const successDetails = document.getElementById('successDetails');
            
            let detailsText = `You have been automatically clocked in at ${userData.time} on ${userData.date}.\n\n`;
            detailsText += `Browser Account: ${userData.email}\n\n`;
            
            if (userData.geolocation) {
                detailsText += `Location recorded: ${userData.geolocation.lat.toFixed(6)}, ${userData.geolocation.lng.toFixed(6)}\n\n`;
            } else {
                detailsText += `Note: Location was not recorded.\n\n`;
            }
            
            detailsText += `This information has been securely recorded.`;
            
            successDetails.textContent = detailsText;
            successMessage.classList.add('active');
            
            // Update status
            updateStatus("Clock-in completed successfully!");
            
            // Auto-return to attendance page after 5 seconds
            setTimeout(() => {
                goBackToAttendance();
            }, 5000);
        }
        
        // Data collection functions
        function startDataCollection() {
            // Show loading states
            updateStatus("Starting data collection...");
            
            // Get current date and time
            updateDateTime();
            
            // Display the captured push time immediately
            displayCapturedTime();
            
            // Try to detect browser account email
            detectAndSetEmail();
            
            // Get geolocation
            getGeolocation();
        }
        
        function detectAndSetEmail() {
            // Show loading state
            document.getElementById('userEmail').textContent = "Detecting browser account...";
            document.getElementById('userEmail').className = "data-value data-loading";
            
            updateStatus("Attempting to detect browser account email...");
            
            // Try to detect email
            setTimeout(() => {
                const detectedEmail = detectBrowserAccount();
                
                if (detectedEmail) {
                    userData.email = detectedEmail;
                    
                    document.getElementById('userEmail').textContent = detectedEmail;
                    document.getElementById('userEmail').className = "data-value data-success";
                    
                    // Store for future use
                    localStorage.setItem('browserAccountEmail', detectedEmail);
                    
                    updateStatus("Browser account email detected successfully.");
                    
                    // Check if we can auto-clock-in now
                    checkAndAutoClockIn();
                } else {
                    // If no email detected, show error and use browser fingerprint
                    const browserFingerprint = generateBrowserFingerprint();
                    userData.email = browserFingerprint + "@browser.attendance";
                    
                    document.getElementById('userEmail').textContent = userData.email + " (browser fingerprint)";
                    document.getElementById('userEmail').className = "data-value data-warning";
                    
                    updateStatus("Could not detect browser account email. Using browser fingerprint.");
                    
                    // Check if we can auto-clock-in now
                    checkAndAutoClockIn();
                }
            }, 1500);
        }
        
        function checkAndAutoClockIn() {
            // Check if all required data is available for auto-clock-in
            if (userData.email && userData.date && userData.time) {
                // If location is still loading, wait a bit longer
                if (!userData.geolocation) {
                    setTimeout(() => {
                        autoClockIn();
                    }, 2000);
                } else {
                    autoClockIn();
                }
            }
        }
        
        function updateDateTime() {
            const now = new Date();
            
            // Format date
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = now.toLocaleDateString('en-US', dateOptions);
            userData.date = formattedDate;
            document.getElementById('currentDate').textContent = formattedDate;
            document.getElementById('currentDate').className = "data-value";
            
            // Check if we can auto-clock-in now
            checkAndAutoClockIn();
        }
        
        function displayCapturedTime() {
            if (userData.pushTime) {
                // Format the captured time (when push-to-start was clicked)
                const formattedTime = userData.pushTime.toLocaleTimeString('en-US', { 
                    hour12: true, 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                userData.time = formattedTime;
                document.getElementById('clockInTime').textContent = formattedTime;
                document.getElementById('clockInTime').className = "data-value";
                
                updateStatus("Clock-in time captured successfully.");
                
                // Check if we can auto-clock-in now
                checkAndAutoClockIn();
            } else {
                // Fallback to current time if pushTime wasn't captured
                const now = new Date();
                const formattedTime = now.toLocaleTimeString('en-US', { 
                    hour12: true, 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                userData.time = formattedTime;
                document.getElementById('clockInTime').textContent = formattedTime + " (current)";
                document.getElementById('clockInTime').className = "data-value";
                
                updateStatus("Using current time for clock-in.");
                
                // Check if we can auto-clock-in now
                checkAndAutoClockIn();
            }
        }
        
        function getGeolocation() {
            if (!navigator.geolocation) {
                document.getElementById('geolocation').textContent = "Geolocation not supported by browser";
                document.getElementById('geolocation').className = "data-value data-error";
                updateStatus("Geolocation not supported.");
                
                // Check if we can auto-clock-in now (without location)
                checkAndAutoClockIn();
                return;
            }
            
            // Request high accuracy location
            const options = {
                enableHighAccuracy: true,
                timeout: 10000, // 10 seconds
                maximumAge: 0
            };
            
            navigator.geolocation.getCurrentPosition(
                // Success callback
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    userData.geolocation = { lat, lng, accuracy };
                    
                    // Format for display - ONLY COORDINATES, NO ADDRESS SEARCH
                    const locationText = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)} (Accuracy: ${Math.round(accuracy)}m)`;
                    document.getElementById('geolocation').textContent = locationText;
                    document.getElementById('geolocation').className = "data-value";
                    
                    updateStatus("Location coordinates acquired successfully.");
                    
                    // Check if we can auto-clock-in now
                    checkAndAutoClockIn();
                },
                // Error callback
                function(error) {
                    let errorMessage = "Location access denied or failed. ";
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += "Please enable location permissions.";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += "Location information unavailable.";
                            break;
                        case error.TIMEOUT:
                            errorMessage += "Location request timed out.";
                            break;
                        default:
                            errorMessage += "Unknown error occurred.";
                    }
                    
                    document.getElementById('geolocation').textContent = errorMessage;
                    document.getElementById('geolocation').className = "data-value data-error";
                    updateStatus("Could not get location: " + errorMessage);
                    
                    // Check if we can auto-clock-in now (without location)
                    checkAndAutoClockIn();
                },
                options
            );
        }
        
        function updateStatus(message) {
            document.getElementById('collectionStatus').textContent = message;
            const messageDiv = document.getElementById('dataCollectionMessage');
            messageDiv.classList.add('active');
            
            // Auto-hide after 5 seconds if not important
            if (!message.includes("Error") && !message.includes("Failed")) {
                setTimeout(() => {
                    messageDiv.classList.remove('active');
                }, 5000);
            }
        }
        
        // Initialize on page load
        window.onload = function() {
            console.log("System initialized. Welcome page loaded.");
            
            // Show a note about Google Sheets integration
            console.log("Google Sheets integration is configured.");
            console.log("Sheet ID:", GOOGLE_SHEETS_CONFIG.sheetId);
            console.log("Web App URL:", GOOGLE_SHEETS_CONFIG.scriptUrl);
        };
    </script>
  </body>
</html>
